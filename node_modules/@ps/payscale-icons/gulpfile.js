var gulp = require('gulp');
var del = require('del');
var replace = require('gulp-replace');
var rename = require('gulp-rename');
var runSequence = require('run-sequence');
var sass = require('gulp-sass');
var version = require('./package.json').version;

gulp.task('clean', function() {
    return del(['./dist', './cdn']);
});

gulp.task('sass', function() {
    return gulp.src(['./css/payscale-icons-ext.scss'])
        .pipe(sass())
        .pipe(replace('../font/payscale-icons', `https://cdn-payscale.com/resources/payscale-icons/${version}/font/payscale-icons`))
        .pipe(rename('payscale-icons-ext.css'))
        .pipe(gulp.dest('./dist/css'))
        .pipe(gulp.dest(`./cdn/${version}/css`));
});

gulp.task('css', function() {
    return gulp.src(['./css/*.css'])
        .pipe(replace('../font/payscale-icons', `https://cdn-payscale.com/resources/payscale-icons/${version}/font/payscale-icons`))
        .pipe(gulp.dest('./dist/css'))
        .pipe(gulp.dest(`./cdn/${version}/css`));

});

gulp.task('font', function() {
    return gulp.src(['./font/*'])
        .pipe(gulp.dest('./dist/font'))
        .pipe(gulp.dest(`./cdn/${version}/font`));
});

gulp.task('default', function(cb) {
    runSequence('clean', ['sass', 'css', 'font'], cb);
});
